import os
from pathlib import Path
from dotenv import load_dotenv

# Загружаем переменные из .env файла
load_dotenv()

# --- Пути ---
BASE_DIR = Path(__file__).resolve().parent.parent
DATA_DIR = BASE_DIR / "data"
OUTPUT_DIR = DATA_DIR / "output"

# Убедимся, что директория для вывода существует
OUTPUT_DIR.mkdir(parents=True, exist_ok=True)

# --- Ключи API ---
GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")
NEWSAPI_KEY = os.getenv("NEWSAPI_KEY")
BOT_TOKEN = os.getenv("BOT_TOKEN")

# Проверяем наличие токена
if not BOT_TOKEN:
    raise ValueError("Токен телеграм-бота (BOT_TOKEN) не найден в .env файле.")

# --- Настройки Telegram ---
CHAT_ID = os.getenv("SUPERGROUP_ID")
CURRENCY_ID = os.getenv("CURRENCY_ID")
CRYPTO_ID = os.getenv("CRYPTO_ID")
USA_STOCKS_ID = os.getenv("USA_STOCKS_ID")

# --- Опции парсинга новостей ---
NEWS_SOURCE = "google"  # Варианты: "google", "newsapi"

# --- Промпты для Gemini ---

USA_STOCKS_PROMPT = """Ты — опытный количественный трейдер и аналитик финансового рынка США. Твоя задача — максимально быстро и точно проанализировать представленный список свежих новостей и дать конкретные, готовые к действию, торговые рекомендации.

**Твои шаги:**

1.  **Выдели 5 Главные Инвестиционные Темы:** Определи 3-5 наиболее сильные и взаимосвязанные темы, имеющие прямое влияние на рынок США (например, AI/Полупроводники, M&A в банках, Геополитика/Защитные активы).
2.  **Определи Ценные Бумаги (Тикеры):** Для каждой темы выдели **3-5 конкретных, напрямую затронутых тикеров NASDAQ/NYSE** (например, AMD, GOOGL, JPM, GLD, TSLA).
3.  **Оцени Торговый Горизонт:** Определи типичный горизонт для торговли по каждой теме (Краткосрочный [1-7 дней], Среднесрочный [1-3 месяца], Долгосрочный [6+ месяцев]).
4.  **Сформулируй Тезис:** Для каждого тикера кратко (1 предложение) объясни, почему новость является **бычьим** (покупка) или **медвежьим** (продажа/шорт) катализатором.
5.  **Сформируй Таблицу-Резюме (Приоритет):** Составь финальную таблицу с четырьмя самыми сильными и выгодными торговыми идеями, используя только 4 колонки: **Тема**, **Тикер**, **Направление (Покупка/Шорт)**, **Горизонт**.

**ФОРМАТ ВЫХОДА (строго соблюдай структуру):**

1.  **КЛЮЧЕВЫЕ ТЕМЫ:** [Список 3-4 тем]
2.  **РЕЗЮМЕ ТОРГОВЫХ ИДЕЙ:** (Таблица, содержащая ТОП-4 идеи из п. 5)
3.  **АНАЛИЗ И ТЕЗИСЫ:** (Краткое описание каждой темы, почему она важна, и тезис для каждого тикера, как в п. 4. Общий объем этого раздела **не более 1500 символов**.)
4.  **ЗАПРОС НА ВТОРОЙ ЭТАП:** (Укажи **4-5 Тикера** для запроса технического анализа на следующем этапе. Выбери те, где требуется подтверждение тренда или уровня.)

*Новостные данные:* [Вставь полный дайджест новостей]"""

# --- Конфигурация топиков для анализа ---
TOPIC_CONFIGS = {
    "USA_STOCKS": {
        "id": os.getenv("USA_STOCKS_ID"),
        "prompt": USA_STOCKS_PROMPT,
        "news_source": "google",
        "news_topics": ['WORLD','BUSINESS','TECHNOLOGY',
                        'ECONOMY','FINANCE','ENERGY']
    },
    # Пример, как можно будет добавить другие анализы:
    "CRYPTO": {
        "id": os.getenv("CRYPTO_ID"),
    #     "prompt": "Другой, кастомный промпт для крипты...",
    #     "news_source": "google",
    #     "news_topics": ['CRYPTOCURRENCIES', 'BITCOIN', 'ETHEREUM']
    },
    "CURRENCY": {
        "id": os.getenv("CURRENCY_ID"),
    #     "prompt": "Промпт для валютного анализа...",
    #     "news_source": "google",
    #     "news_topics": ['FOREX', 'CURRENCY']
    }
}